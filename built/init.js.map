{"version":3,"file":"init.js","sourceRoot":"","sources":["../src/init.js"],"names":[],"mappings":"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","sourcesContent":["\nimport * as THREE from 'three'\nimport { OrbitControls } from 'OrbitControls'\nimport { DeviceOrientationControls } from 'DeviceOrientationControls'\nimport Stats from 'Stats'\nimport { StereoEffect } from 'StereoEffect'\nimport {\n  originalSpaceBoundaryX,\n  originalSpaceBoundaryY,\n  originalSpaceBoundaryZ\n} from './settings.js'\nimport { drawBox } from './drawingHelpers.js'\nimport { clearState } from './stateStorage.js'\nimport {\n  makeClonePositionsList\n  ,\n  createParticleSystem, particleMaterialForClones\n} from './particleSystem.js'\n\nimport * as dat from 'dat.gui'\n\nconst ifMobileDevice =\n/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n  navigator.userAgent\n)\n\nfunction fullscreen () {\n  if (document.body.requestFullscreen) {\n    document.body.requestFullscreen()\n  } else if (document.body.msRequestFullscreen) {\n    document.body.msRequestFullscreen()\n  } else if (document.body.mozRequestFullScreen) {\n    document.body.mozRequestFullScreen()\n  } else if (document.body.webkitRequestFullscreen) {\n    document.body.webkitRequestFullscreen()\n  }\n}\nfunction init (settings,\n  particles,\n  time,\n  lastSnapshotTime) {\n  // initialize the scene\n  const scene = new THREE.Scene()\n  //    configure the scene:\n  if (settings.if_useFog) {\n    scene.fog = new THREE.Fog(0xffffff, 0, 20)\n  }\n  //    define objects:\n  let boxMesh = null\n  if (settings.if_showUniverseBoundary) {\n    boxMesh = drawBox(\n      settings.spaceBoundaryX,\n      settings.spaceBoundaryY,\n      settings.spaceBoundaryZ,\n      scene\n    )\n  }\n  const group = new THREE.Object3D()\n  const particleSystem = createParticleSystem(\n    group,\n    particles,\n    scene,\n    time,\n    lastSnapshotTime,\n    settings\n  )\n  console.log(\"3D object 'group' created: \", group)\n  scene.add(group)\n  console.log(particles)\n  // enable settings GUI\n  initializeGuiControls(settings, group, boxMesh)\n  // initialize the camera\n  const camera = new THREE.PerspectiveCamera(\n    90,\n    window.innerWidth / window.innerHeight,\n    1,\n    1000000\n  )\n  camera.position.set(0, 2, 10)\n  scene.add(camera)\n  // initialize renderer\n  const renderer = new THREE.WebGLRenderer({\n    alpha: true\n  })\n  renderer.setSize(window.innerWidth, window.innerHeight)\n  let effect\n  if (ifMobileDevice) {\n    effect = new StereoEffect(renderer)\n  }\n  const element = renderer.domElement\n  document.body.appendChild(element)\n  // activate plugins:\n  const controls = new OrbitControls(camera, element) // this is for non-VR devices\n  function setOrientationControls (e) {\n    if (!e.alpha) {\n      return\n    }\n    const controls = new DeviceOrientationControls(camera, true)\n    controls.connect()\n    controls.update()\n    element.addEventListener('click', fullscreen, false)\n    window.removeEventListener(\n      'deviceorientation',\n      setOrientationControls,\n      true\n    )\n  }\n  window.addEventListener('deviceorientation', setOrientationControls, true)\n  // add stat\n  const stats = new Stats()\n  const temperaturePanel = stats.addPanel(new Stats.Panel('Temp.', '#ff8', '#221'))\n  stats.showPanel(2)\n  document.body.append(stats.domElement)\n  // add event listeners\n  window.addEventListener('resize', () => { resize(camera, effect, renderer) }, false)\n  setTimeout(() => { resize(camera, effect, renderer) }, 1)\n  // State persistence handled in TypeScript (script.ts) to include full particle data.\n  return [scene, particleSystem, camera, renderer, controls, stats, temperaturePanel, effect]\n}\n\nfunction updateClonesPositions (\n  spaceBoundaryX,\n  spaceBoundaryY,\n  spaceBoundaryZ,\n  group\n) {\n  const clonePositions = makeClonePositionsList(\n    spaceBoundaryX,\n    spaceBoundaryY,\n    spaceBoundaryZ\n  )\n  for (let i = 0; i < 26; i++) {\n    group.children[i + 1].position.set(\n      clonePositions[i].x,\n      clonePositions[i].y,\n      clonePositions[i].z\n    )\n  }\n}\n\nfunction resize (camera, effect, renderer) {\n  const width = document.body.offsetWidth\n  const height = document.body.offsetHeight\n  camera.aspect = width / height\n  camera.updateProjectionMatrix()\n  renderer.setSize(width, height)\n  if (ifMobileDevice) effect.setSize(width, height)\n}\n// (initializeGuiControls is invoked inside init())\nfunction initializeGuiControls (settings, group, boxMesh) {\n// Enable the GUI Controls powered by \"dat.gui.min.js\":\n  const gui = new dat.GUI()\n\n  const guiFolderWorld = gui.addFolder('World building')\n\n  guiFolderWorld.add(settings, 'if_constant_temperature').name('Constant T')\n  guiFolderWorld.add(settings, 'targetTemperature').name('Target temp.')\n\n  const guiFolderParameters = guiFolderWorld.addFolder('Parameters') // toggles for parameters:\n  guiFolderParameters.add(settings, 'particleCount')\n  guiFolderParameters.add(settings, 'dt')\n\n  const guiFolderConstants = guiFolderWorld.addFolder('Physical Constants') // physical constants -- be the god!\n  guiFolderConstants.add(settings, 'EPSILON')\n  guiFolderConstants.add(settings, 'DELTA')\n  guiFolderConstants.add(settings, 'G')\n  guiFolderConstants.add(settings, 'K')\n\n  const guiFolderBoundary = guiFolderWorld.addFolder('Universe boundary')\n  guiFolderBoundary.add(settings, 'if_showUniverseBoundary')\n  guiFolderBoundary\n    .add(settings, 'if_use_periodic_boundary_condition')\n    .name('Use PBC')\n    .onChange(() => {\n      particleMaterialForClones.visible = settings.if_use_periodic_boundary_condition\n    })\n  const guiFolderSize = guiFolderBoundary.addFolder('Custom size')\n  guiFolderSize\n    .add(settings, 'spaceBoundaryX')\n    .name('Size, X')\n  .onChange(function () {\n      if (boxMesh) {\n        boxMesh.scale.x = settings.spaceBoundaryX / originalSpaceBoundaryX\n      }\n      updateClonesPositions(\n        settings.spaceBoundaryX,\n        settings.spaceBoundaryY,\n        settings.spaceBoundaryZ,\n        group\n      )\n    })\n  guiFolderSize\n    .add(settings, 'spaceBoundaryY')\n    .name('Size, Y')\n  .onChange(function () {\n      if (boxMesh) {\n        boxMesh.scale.y = settings.spaceBoundaryY / originalSpaceBoundaryY\n      }\n      updateClonesPositions(\n        settings.spaceBoundaryX,\n        settings.spaceBoundaryY,\n        settings.spaceBoundaryZ,\n        group\n      )\n    })\n  guiFolderSize\n    .add(settings, 'spaceBoundaryZ')\n    .name('Size, Z')\n  .onChange(function () {\n      if (boxMesh) {\n        boxMesh.scale.z = settings.spaceBoundaryZ / originalSpaceBoundaryZ\n      }\n      updateClonesPositions(\n        settings.spaceBoundaryX,\n        settings.spaceBoundaryY,\n        settings.spaceBoundaryZ,\n        group\n      )\n    })\n\n  const guiFolderForces = guiFolderWorld.addFolder('Forcefields to apply')\n  guiFolderForces.add(settings, 'if_apply_LJpotential').name('LJ potential')\n  guiFolderForces.add(settings, 'if_apply_gravitation').name('Gravitation')\n  guiFolderForces.add(settings, 'if_apply_coulombForce').name('Coulomb Force')\n\n  guiFolderWorld.open()\n\n  const guiFolderPlotting = gui.addFolder('Plotting') // toggles for Plotting:\n  // guiFolderPlotting.add(settings, \"if_override_particleCount_setting_with_lastState\").name(\"\");\n  guiFolderPlotting.add(settings, 'referenceFrameMode', { 'Fixed': 'fixed', 'Sun': 'sun', 'Center of Mass': 'com' })\n    .name('Reference frame')\n\n  // (sun & fog toggles managed elsewhere)\n\n  const guiFolderTrajectories = guiFolderPlotting.addFolder(\n    'Particle trajectories'\n  )\n  guiFolderTrajectories.add(settings, 'if_showTrajectory').name('Trace')\n  guiFolderTrajectories\n    .add(settings, 'maxTrajectoryLength')\n    .name('Length')\n  .onChange(function () { /* length change handler TBD */ })\n\n  const guiFolderArrows = guiFolderPlotting.addFolder(\n    'Arrows for forces and velocities'\n  )\n  guiFolderArrows\n    .add(settings, 'if_showArrows')\n    .name('Show arrows')\n    .onChange(function () { /* instanced arrows handle visibility externally */ })\n  guiFolderArrows.add(settings, 'if_limitArrowsMaxLength').name('Limit length')\n  guiFolderArrows.add(settings, 'maxArrowLength').name('Max length')\n  guiFolderArrows.add(settings, 'unitArrowLength').name('Unit length')\n  guiFolderArrows\n    .add(settings, 'if_showMapscale')\n    .name('Show scales')\n  .onChange(() => { toggle('.mapscale') })\n  guiFolderArrows\n    .add(settings, 'if_proportionate_arrows_with_vectors')\n    .name('Proportionate arrows with vectors')\n\n  guiFolderPlotting.open()\n\n  const commands = {\n    stop: () => {\n      settings.ifRun = false\n    },\n    toggleHUD: () => {\n      toggle('#hud')\n    },\n    clearState\n  }\n  const guiFolderCommands = gui.addFolder('Commands') // controls, buttons\n  guiFolderCommands.add(commands, 'clearState').name('New world')\n  guiFolderCommands.add(commands, 'stop').name('Halt')\n  gui.add(commands, 'toggleHUD').name('Show Detail HUD')\n  guiFolderCommands.open()\n\n  gui.remember(this)\n  gui.close()\n}\n\nfunction toggle (selector) {\n  const element = document.querySelector(selector)\n  if (element.style.display === 'none') {\n    element.style.display = 'block'\n  } else {\n    element.style.display = 'none'\n  }\n}\n\nexport { init, ifMobileDevice, toggle }\n"]}